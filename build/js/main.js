function ChineseCheckers(){return this.version="1.0.0",this}ChineseCheckers.prototype=function(){function e(){}function n(){function n(){t="111111111100000000000000000000000000000000000000000000000000000000000002222222222".split("").map(function(e){return+e}),curr=1,y()}function w(){var e=$(window).width(),n=$(window).height(),r=1/1.7,t=e/n;t>r?(d=.8*n,f=d*r):(f=.8*e,f/=r),l=d/254,s.width(f),s.height(d),s.find("canvas").each(function(){this.width=f,this.height=d}),o.hide(),function(){var e=1,n=15*l,r={x:5*n,y:n},t=1;v=[];for(var i=0;17>i;i++){for(var a=0;t>a;a++)v.push({x:r.x+a*n,y:r.y});i>=8&&(e=-1),t+=e,r.x+=-e/2*n,r.y+=n/2*Math.sqrt(3)}}(),function(){x=[],i.removeAllChildren(),i.clear();for(var e=4*l,n=0,r=v.length;r>n;n++){var t=v[n];x.push(function(){var a=new createjs.Shape;a.graphics.beginStroke(function(){return 10>n?"blue":10>=r-n?"red":"#999"}()).drawCircle(0,0,e),a.x=t.x,a.y=t.y,i.addChild(a)}())}var a=new createjs.Text("turn",12*l+"px Arial","#333");a.x=v[43].x+e,a.y=v[0].y,a.textBaseline="alphabetic",i.addChild(a),i.update()}(),y()}function m(){O&&(O=!1,a.update(event))}function y(){var e=6*l,n=null;a.removeAllChildren(),a.clear();for(var c=0,u=t.length;u>c;c++)if(0!==+t[c]){var h=new createjs.Shape;h.graphics.beginFill(function(){return 1===+t[c]?"blue":"red"}()).drawCircle(0,0,e),h.checkerIndex=c+1,h.on("mousedown",function(){curr===t[this.checkerIndex-1]-1&&(n&&(n.scaleX=n.scaleY=1),this.scaleX=this.scaleY=1.2,n=this,C(k.listMoves(r(),curr,n.checkerIndex-1)),p=this.checkerIndex,O=!0)}),h.x=v[c].x,h.y=v[c].y,a.addChild(h)}a.update(),i.curr&&(i.removeChild(i.curr),i.curr=null);var o=new createjs.Shape;o.graphics.beginFill(function(){return 0===+curr?"blue":"red"}()).drawCircle(0,0,e),o.x=v[44].x,o.y=v[2].y,i.curr=o,i.addChild(o),i.update()}function C(e){var n=this;this.currentHightlight&&($.each(this.currentHightlight,function(e,n){a.removeChild(n)}),this.currentHightlight=[]),$.each(e,function(e,r){var t=5*l,i=new createjs.Shape;i.graphics.beginFill(function(){return"green"}()).drawCircle(0,0,t),i.x=v[+r-1].x,i.y=v[+r-1].y,i.checkerIndex=+r,n.currentHightlight||(n.currentHightlight=[]),n.currentHightlight.push(i),i.on("mousedown",function(){g=this.checkerIndex,b(p,g)}),a.addChild(i)}),O=!0}function b(e,n){t[n-1]=t[e-1],t[e-1]=0,console.log("Player "+(curr?"red":"blue")+" move from "+e+" to "+n+"."),curr=curr?0:1,y(),j()}function j(){for(var e=0,r=0,i=0,a=0,c=0,u=t.length;u>c;c++)10>c?t[c]>0&&(i++,e|=1===t[c]?1:2):c>70&&t[c]>0&&(a++,r|=1===t[c]?1:2);10===i&&3===e?(console.log("player red win"),alert("player red win"),n()):10===a&&3===r&&(console.log("player blue win"),alert("player blue win"),n())}t="111111111100000000000000000000000000000000000000000000000000000000000002222222222".split("").map(function(e){return+e}),curr=1;var k=new e;s=$(".game"),u=$("#bg-stage"),h=$("#main-stage"),o=$("#animation-stage"),i=new createjs.Stage("bg-stage"),a=new createjs.Stage("main-stage"),c=new createjs.Stage("animation-stage");var O=!0;createjs.Ticker.addEventListener("tick",m),createjs.Touch.enable(a),createjs.Touch.enable(c),w(),$(window).resize(w)}function r(){return t.join("")}var t,i,a,c,u,h,o,s,l,f,d,p,g,v=[],x=[];return e.prototype={mapping:function(){for(var e=[],n=1,r=1,t=0;17>t;t++){t>=8&&(r=-1);var i=r>0?9*(n-1):72+t-8;e.push(i);for(var a=0;n-1>a;a++)e.push(i-8*(a+1));n+=r}return e}(),transform:function(e,n){var r=this.mapping,t=function(){for(var e=[],n=0;81>n;n++)e.push(0);return e}();return $(e.split("")).each(n?function(e,n){t[r.indexOf(e)]=n}:function(e,n){t[r[e]]=+n}),t},listMoves:function(e,n,r,t,i){function a(e,n){var r=n%9,t=n/9;7>r&&t>1&&0===e[n-16]&&e[n-8]>0&&u.indexOf(n-16)<0&&(u.push(n-16),a(e,n-16)),t>1&&0===e[n-18]&&e[n-9]>0&&u.indexOf(n-18)<0&&(u.push(n-18),a(e,n-18)),7>r&&0===e[n+2]&&e[n+1]>0&&u.indexOf(n+2)<0&&(u.push(n+2),a(e,n+2)),7>t&&0===e[n+18]&&e[n+9]>0&&u.indexOf(n+18)<0&&(u.push(n+18),a(e,n+18)),7>t&&r>1&&0===e[n+16]&&e[n+8]>0&&u.indexOf(n+16)<0&&(u.push(n+16),a(e,n+16)),r>1&&0===e[n-2]&&e[n-1]>0&&u.indexOf(n-2)<0&&(u.push(n-2),a(e,n-2))}var c,u=[],h=this;if(c=t?e.split(""):h.transform(e),c=c.map(function(e){return+e}),r=t?r:h.mapping[r],c[r]!==n+1)return[];var o=r%9,s=parseInt(r/9);return function(){8>o&&s>0&&0===c[r-8]&&u.push(r-8),8>o&&0===c[r+1]&&u.push(r+1),o>0&&0===c[r-1]&&u.push(r-1),s>0&&0===c[r-9]&&u.push(r-9),8>s&&o>0&&0===c[r+8]&&u.push(r+8),8>s&&0===c[r+9]&&u.push(r+9)}(),a(c,r),u=i?u:u.map(function(e){return h.mapping.indexOf(+e)+1})}},{test:function(){console.log(this)},tringify:r,run:function(){n(),console.log("i'm running!")}}}(),$(document).ready(function(){(new ChineseCheckers).run()});